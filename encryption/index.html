
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://virgesmith.github.io/encryption/">
      
      
        <meta name="author" content="Andrew P Smith">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>Encryption and open-source - Research Reproducibility Ramblings</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-purple">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#encryption-and-open-source" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://virgesmith.github.io" title="Research Reproducibility Ramblings" class="md-header-nav__button md-logo" aria-label="Research Reproducibility Ramblings">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Research Reproducibility Ramblings
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Encryption and open-source
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/virgesmith/virgesmith.github.io/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://virgesmith.github.io" title="Research Reproducibility Ramblings" class="md-nav__button md-logo" aria-label="Research Reproducibility Ramblings">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Research Reproducibility Ramblings
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/virgesmith/virgesmith.github.io/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" checked>
    <label class="md-nav__link" for="nav-1">
      Articles
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Articles" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        Articles
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../anatomy/" class="md-nav__link">
      Anatomy of a successful research software project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bad-algorithms/" class="md-nav__link">
      Bad algorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../float/" class="md-nav__link">
      Floating-point (ir)reproducibity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../difficult-data/" class="md-nav__link">
      How (not) to supply data
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Encryption and open-source
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Encryption and open-source
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#encrypt-the-data" class="md-nav__link">
    Encrypt the data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sharing-the-key" class="md-nav__link">
    Sharing the key
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-services" class="md-nav__link">
    App Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-code" class="md-nav__link">
    The code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#takeaways" class="md-nav__link">
    Takeaways
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" class="md-nav__link">
      About me
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#encrypt-the-data" class="md-nav__link">
    Encrypt the data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sharing-the-key" class="md-nav__link">
    Sharing the key
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-services" class="md-nav__link">
    App Services
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-code" class="md-nav__link">
    The code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#takeaways" class="md-nav__link">
    Takeaways
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/virgesmith/virgesmith.github.io/edit/master/docs/encryption.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="encryption-and-open-source">Encryption and open-source<a class="headerlink" href="#encryption-and-open-source" title="Permanent link">¶</a></h1>
<p>Say you have a project that's some kind of model. It takes some input dataset, some configuration provided by users, and spits out some results when you run it. You'd love to open-source it so that others can use it, but the problem is the raw input data used by the model is confidential. The output from the model sufficiently obfuscates the confidential data, so you want people to be able to use the model but without having access to the input data.</p>
<p>In a closed-source world you'd simply provide a "black box", hiding your model code and data.</p>
<p>But you want users who don't have access to the confidential data to still be able to run your model, and you'd also like collaborators (who do have access to the confidential data) to get involved. And you want the model code itself to be publicly available.</p>
<p>How can you achieve this in an open-source context? Here's one way of doing it, and some pitfalls to watch out for. We'll choose python for our language, but you'd be able to do the same thing in pretty much any language.</p>
<div class="admonition warning">
<p class="admonition-title">Disclaimer</p>
<p>I'm not a security expert. Below are some basic guidelines and examples. You may want to consult a security professional if you are doing this seriously.</p>
</div>
<h2 id="encrypt-the-data">Encrypt the data<a class="headerlink" href="#encrypt-the-data" title="Permanent link">¶</a></h2>
<p>It goes without saying, if you're using confidential data, it's your responsibility to safeguard it. Python has a handy encryption package, uncryptically called <a href="https://cryptography.io/en/latest/">cryptography</a>. We'll just use its default encryption setting (symmetric 128 bit AES), so we just need to generate a key</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">Fernet</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ENCRYPTION_KEY=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">envvar</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
</code></pre></div>

<p>then use it to encrypt the data, and later the same key to decrypt it. When you run it you'll see a base-64 encoded key, something like this:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">ENCRYPTION_KEY</span><span class="o">=</span><span class="nv">2b6sNDrSiuFMDmG58vliW8jzeHy5i91KQA5pIkLsRnw</span><span class="o">=</span>
</code></pre></div>

<p>We can then use this key to encrypt our confidential dataset, delete the plaintext, then subsequently use the key to decrypt the dataset. So we need to keep this information safe and secret. The obvious solution is to put it in a file, say <code>encryption_key</code>. This is where the first pitfall lies - you definitely don't want this file ending up in source control, or you'll have exposed the key to everyone. Simple - make sure you add the filename to your <code>.gitignore</code> file.</p>
<h2 id="sharing-the-key">Sharing the key<a class="headerlink" href="#sharing-the-key" title="Permanent link">¶</a></h2>
<p>When another researcher - one you trust - wants to run the software, you need to provide them with the key (and then trust that they also keep the key safe).</p>
<p>When someone else wants to run your code - someone you don't fully trust - there's a problem: they can't run your model on their computer without knowing the secret key, and you're not prepared to give it to them. But you'd like them to be able to run your model, so you need to somehow provide access to your model, but without access to the key. This is where the cloud comes in...</p>
<h2 id="app-services">App Services<a class="headerlink" href="#app-services" title="Permanent link">¶</a></h2>
<p>You can use a cloud-based app service to achieve this. Your model will need a browser interface or API (not covered here) but means anyone can use it yet can't see the internals, especially the secret key. Or can they? Typically, you'd create a docker container with your app running in it for easy cloud deployment. Sorted? Not necessarily. The problem is, your docker container needs the secret key to work, and if you store your container in a public repository, then you've exposed the secret key to everyone, just as if you'd put the key in your (public) github repository, because anyone can pull your image and inspect the contents.</p>
<p>You could make your image private, but this goes against the grain of the open-source ethos. Or perhaps you could store your key in a (private) docker volume and mount it when you deploy your app. But there is a simpler solution: use an <em>environment variable</em>. This way, you can deploy your container in the cloud, and configure the app service's environment to have a variable containing the key. Only those with access to the app service configuration can see it, and you would never allow your app service configuration to be public, as you'd expose yourself to all sorts of potential hackery.</p>
<p>When your model runs, you must ensure you don't save the decrypted dataset to the filesystem. Somebody might be able to inspect your container while it's running and get hold of the plaintext dataset, and locally, you again run the risk of accidentally commiting the dataset to source control.</p>
<p>This way you can let people use your app service without ever exposing the key, or the plaintext dataset.</p>
<h2 id="the-code">The code<a class="headerlink" href="#the-code" title="Permanent link">¶</a></h2>
<p>So you need an environment variable containing a secret. You could add this to your global environment, then every process you're running knows the secret key, which is a potential security risk. As it's only used by this particular application, just set it on a "need-to-know" basis - and keep it self contained within the package itself, in a file (that must be of course be in both <code>.gitignore</code> <em>and</em> <code>.dockerignore</code>). Python has a handy package called <code>python-dotenv</code> which is designed for this purpose (other languages have similar). You call a function <code>load_dotenv()</code> at startup and it will "source" your local environment from a file (by default it looks for <code>.env</code> in the project root). This file just needs to contain the text from above:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">ENCRYPTION_KEY</span><span class="o">=</span><span class="nv">2b6sNDrSiuFMDmG58vliW8jzeHy5i91KQA5pIkLsRnw</span><span class="o">=</span>
</code></pre></div>

<p>Let's say the dataset is a csv file and you want to load it into a pandas dataframe. We can wrap the details in read and write functions. The first thing you need to do is load your plaintext dataset, encrypt it, save it, and delete the plaintext:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>

<span class="c1"># get key from .env file, if present</span>
<span class="n">load_dotenv</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_get_key</span><span class="p">():</span>
  <span class="n">key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;ENCRYPTION_KEY&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">EnvironmentError</span><span class="p">(</span><span class="s2">&quot;ENCRYPTION_KEY not set&quot;</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">key</span>

<span class="k">def</span> <span class="nf">encrypt_csv</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Encrypts a dataframe and saves to filesystem in csv format &quot;&quot;&quot;</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
  <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

  <span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">_get_key</span><span class="p">())</span>
  <span class="n">encrypted</span> <span class="o">=</span> <span class="n">fernet</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

  <span class="c1"># Write the encrypted file</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>

<span class="n">plaintext</span> <span class="o">=</span> <span class="s2">&quot;secret-data.csv&quot;</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span>
<span class="n">encrypt_csv</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">plaintext</span> <span class="o">+</span> <span class="s2">&quot;.enc&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span>
</code></pre></div>

<p>The dataframe is saved in csv format to a memory buffer (not a file) which is then encrypted and saved.</p>
<p>Then, when you want to load the data, just do this:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">decrypt_csv</span><span class="p">(</span><span class="n">data_file</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Loads a dataframe from an encrypted csv file &quot;&quot;&quot;</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

  <span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">_get_key</span><span class="p">())</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">fernet</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>

  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">df</span>

<span class="n">ciphertext</span> <span class="o">=</span> <span class="s2">&quot;secret-data.csv.enc&quot;</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">decrypt_csv</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span>
</code></pre></div>

<h2 id="takeaways">Takeaways<a class="headerlink" href="#takeaways" title="Permanent link">¶</a></h2>
<ul>
<li>whatever you do, don't leak secrets to github, docker hub or any other public repository</li>
<li>ensure - without compromising security - that you don't lose your key</li>
<li>don't share your key with anyone you don't fully trust</li>
<li>use local environment variables to store the secret key, in combination with <code>dotenv</code> if appropriate</li>
<li>decrypt data in-memory, do not write plaintext data to the file system</li>
<li>if in doubt, talk to a security expert</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../difficult-data/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                How (not) to supply data
              </div>
            </div>
          </a>
        
        
          <a href="../about/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                About me
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy 2020-2021 Andrew P Smith
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../js/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>